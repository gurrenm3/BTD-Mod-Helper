<Project ToolsVersion="14.0" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
    <PropertyGroup>
        <!--BloonsTD6 property gets automatically set correctly when this file is generated by the Mod Helper on startup-->
        <BloonsTD6>C:\Program Files (x86)\Steam\steamapps\common\BloonsTD6</BloonsTD6>
        <Il2CppAssemblies>$(BloonsTD6)\MelonLoader\Il2CppAssemblies</Il2CppAssemblies>
        <ManagedFolder>$(BloonsTD6)\MelonLoader\Managed</ManagedFolder>
        <OutputFolder Condition="'$(OutputFolder)' == ''">Mods</OutputFolder>
    </PropertyGroup>

    <!--References to MelonLoader dependencies-->
    <ItemGroup>
        <Reference Include="$(BloonsTD6)\MelonLoader\net6\MelonLoader.dll"/>
        <Reference Include="$(BloonsTD6)\MelonLoader\net6\0Harmony.dll"/>
    </ItemGroup>

    <!--References to BTD6 dependencies-->
    <ItemGroup Condition="'$(JustMelonloader)' != 'true'">
        <Reference Include="$(Il2CppAssemblies)\Assembly-CSharp.dll"/>
        <Reference Include="$(Il2CppAssemblies)\Il2Cppmscorlib.dll"/>
        <Reference Include="$(Il2CppAssemblies)\Il2CppSystem.Core.dll"/>
        <Reference Include="$(Il2CppAssemblies)\Il2CppSystem.dll"/>
        <Reference Include="$(Il2CppAssemblies)\Il2CppNinjaKiwi.Common.dll"/>
        <Reference Include="$(Il2CppAssemblies)\Il2CppNinjaKiwi.LiNK.dll"/>
        <Reference Include="$(Il2CppAssemblies)\Unity.InputSystem.dll"/>
        <Reference Include="$(Il2CppAssemblies)\Unity.ResourceManager.dll"/>
        <Reference Include="$(Il2CppAssemblies)\Unity.TextMeshPro.dll"/>
        <Reference Include="$(Il2CppAssemblies)\UnityEngine.AnimationModule.dll"/>
        <Reference Include="$(Il2CppAssemblies)\UnityEngine.AssetBundleModule.dll"/>
        <Reference Include="$(Il2CppAssemblies)\UnityEngine.AudioModule.dll"/>
        <Reference Include="$(Il2CppAssemblies)\UnityEngine.CoreModule.dll"/>
        <Reference Include="$(Il2CppAssemblies)\UnityEngine.dll"/>
        <Reference Include="$(Il2CppAssemblies)\UnityEngine.InputLegacyModule.dll"/>
        <Reference Include="$(Il2CppAssemblies)\UnityEngine.ImageConversionModule.dll"/>
        <Reference Include="$(Il2CppAssemblies)\UnityEngine.JSONSerializeModule.dll"/>
        <Reference Include="$(Il2CppAssemblies)\UnityEngine.TextRenderingModule.dll"/>
        <Reference Include="$(Il2CppAssemblies)\UnityEngine.UI.dll"/>
        <Reference Include="$(Il2CppAssemblies)\UnityEngine.UIElementsModule.dll"/>
        <Reference Include="$(Il2CppAssemblies)\UnityEngine.UIModule.dll"/>
        <!--<Reference Include="$(Il2CppAssemblies)\Newtonsoft.Json.dll"/>-->
        <Reference Include="$(Il2CppAssemblies)\Unity.Addressables.dll"/>
        
        <Reference Include="$(ManagedFolder)\UnityEngine.Il2CppAssetBundleManager.dll"/>
        <Reference Include="$(ManagedFolder)\UnityEngine.Il2CppImageConversionManager.dll"/>
        <Reference Include="$(ManagedFolder)\ValueTupleBridge.dll"/>

        <Reference Include="$(BloonsTD6)\MelonLoader\net6\Il2CppInterop.Runtime.dll"/>
    </ItemGroup>

    <!--Mod Helper dependency-->
    <ItemGroup Condition="$(DontReferenceModHelper) != 'true'">
        <Reference Include="BloonsTD6 Mod Helper" Condition="Exists('$(BloonsTD6)\Mods\Btd6ModHelper.dll')">
            <HintPath>$(BloonsTD6)\Mods\Btd6ModHelper.dll</HintPath>
        </Reference>
        <Reference Include="BloonsTD6 Mod Helper" Condition="Exists('$(BloonsTD6)\Mods\BloonsTD6 Mod Helper.dll')">
            <HintPath>$(BloonsTD6)\Mods\BloonsTD6 Mod Helper.dll</HintPath>
        </Reference>
    </ItemGroup>

    <!--Automatic embeds-->
    <ItemGroup Condition="'$(AutoEmbed)' != 'false'">
        <EmbeddedResource Include="**/*.png"/>
        <EmbeddedResource Include="**/*.jpg"/>
        <EmbeddedResource Include="**/*.bundle"/>
        <EmbeddedResource Include="**/*.bytes"/>
        <EmbeddedResource Condition="Exists('ModHelperData.json')" Include="ModHelperData.json"/>
        <EmbeddedResource Condition="Exists('ModHelperData.txt')" Include="ModHelperData.txt"/>
    </ItemGroup>

    <!--Post build events to copy dll/xml to mods folder. Works even if game is currently running-->
    <Target Name="MoveDllToMods" AfterTargets="Build" Condition="Exists('$(TargetDir)$(TargetName).dll')">
        <Message Text="Copying $(ProjectName).dll to $(OutputFolder) Folder..." Importance="High"/>

        <Delete Condition="Exists('$(BloonsTD6)\$(OutputFolder)\BloonsTD6 Mod Helper\Old Mods\$(ProjectName).dll')"
                Files="$(BloonsTD6)\$(OutputFolder)\BloonsTD6 Mod Helper\Old Mods\$(ProjectName).dll"/>
        
        <Move Condition="Exists('$(BloonsTD6)\$(OutputFolder)\$(ProjectName).dll')"
              SourceFiles="$(BloonsTD6)\$(OutputFolder)\$(ProjectName).dll"
              DestinationFiles="$(BloonsTD6)\$(OutputFolder)\BloonsTD6 Mod Helper\Old Mods\$(ProjectName).dll"/>

        <Copy SourceFiles="$(TargetDir)$(TargetName).dll"
              DestinationFiles="$(BloonsTD6)\$(OutputFolder)\$(ProjectName).dll"/>
    </Target>
    <Target Name="MoveXmlToMods" AfterTargets="Build" Condition="Exists('$(TargetDir)$(ProjectName).xml')">
        <Message Text="Copying $(ProjectName).xml to $(OutputFolder) Folder..." Importance="High"/>

        <Copy SourceFiles="$(TargetDir)$(ProjectName).xml"
              DestinationFiles="$(BloonsTD6)\$(OutputFolder)\$(ProjectName).xml"/>
    </Target>
</Project>